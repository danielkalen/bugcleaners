(function(){var A,l,q,n,r,t,I,B,J,C,K,D,L,E,M,F,N,x,k,p,y,v,G,H,w,z,h,u;D=function(a){var b;1<a.length?"radio"===a[0].type||"checkbox"===a[0].type?(b=a,a=[],Object.keys(b).forEach(function(c){if(!isNaN(parseFloat(c)))return a.push(b[c])})):(u("onlyOneDOMElement"),a=a[0]):a=a[0];return a};K=function(a){w.jQuery&&a instanceof jQuery&&(a=D(a),a.length&&(a=a[0]));return a};I=function(){var a;a=document.createEvent("Event");a.initEvent("change",!0,!1);a.fromSimplyBind=!0;return a};L=function(){return"sb_"+
Math.floor(1E12*(1+Math.random())).toString(16)};N=function(a){a=typeof a;return"string"===a||"number"===a};F=function(a){return a instanceof l};t={object:{set:function(a){var b,c;c="Event"===a.type?a.property+"#"+a.eventName:a.property;b=n.objects.indexOf(a.object);return-1===b?(b={},b[c]=a.ID,n.objects.push(a.object),n.props.push(b)):n.props[b][c]=a.ID},get:function(a){var b;b="Event"===a.type?a.property+"#"+a.eventName:a.property;a=n.objects.indexOf(a.object);if(-1!==a&&(a=n.props[a],null!=a[b]))return r[a[b]]}},
"function":{set:function(a){n.fns.push(a.object);return n.fnIDs.push(a.ID)},get:function(a){a=n.fns.indexOf(a.object);if(-1!==a)return r[n.fnIDs[a]]}},external:{set:function(a){n.external.push(a.object+":"+a.property+"#"+JSON.stringify(a.reqOptions));return n.externalOpts.push(a.ID)},get:function(a){a=n.external.indexOf(a.object+":"+a.property+"#"+JSON.stringify(a.reqOptions));if(-1!==a)return r[n.externalOpts[a]]}},textNodes:{nodes:[],nodeValues:[],set:function(a,b,c){if(-1===this.nodes.indexOf(a))return this.nodes.push(a),
this.nodeValues.push([b,c])},get:function(a){a=this.nodes.indexOf(a);if(-1!==a)return this.nodeValues[a]}}};y=null;H=function(){return y=new RegExp(v.start+"([^"+v.end+"]+)"+v.end,"g")};z=function(a,b){var c,d;d=E();c=b?a:C[a];throw Error("SimplyBind: "+(c+("\n\nCall Source:\n"+d)));};u=function(a){var b;if(!p.silent)return b=E(),a=C[a],console.log("SimplyBind: "+(a+("\n\nCall Source:\n"+b)))};h=function(a){return z("You can't use/invoke ."+a+"() at this stage",!0)};E=function(){return Error().stack.split("\n").slice(3,
10).map(function(a){return a.replace(J,function(a,c,d){return"@ "+d})}).join("\n")};J=/[@(?:\wat\s)](.*)\/(.+)$/;C={invalidParamName:"SimplyBind() and .to() only accept a function, a bound object, a string, or a number.",transformFn:"You can only pass a function to the .tranform/All() method",badObject:"You can only pass a non-primitive object to .of()",badEventArg:"Invalid argument number in .ofEvent()",onlyOneDOMElement:"You can only pass 1 DOM element to SimplyBind unless it's a collection of radio/checkbox inputs",
emptyElList:"You can't bind an empty element list to anything..."};w={jQuery:"undefined"!==typeof jQuery&&null!==jQuery};p={silent:!1,liveProps:!0,dispatchEvents:!1,updateEvenIfUndefined:!1,updateEvenIfSame:!1,invokeOnBind:!0,mutateInherited:!1,mutateArrayMethods:!0,cacheRequests:!0,ignoreCase:!1,placeholderStart:"{{",placeholderEnd:"}}"};v={start:"\\{\\{",end:"\\}\\}"};H();n={objects:[],props:[],fns:[],fnIDs:[],external:[],externalOpts:[]};r={};G={};q=function(a,b){if(!a&&0!==a||!N(a)&&"function"!==
typeof a)F(a)||z("invalidParamName");return"object"===typeof a?new l(a._,1,a.placeholder):new A(a,b)};A=function(a,b){var c,d;this.ID=this.type=null;this.selector=this.property=a;this.value=this.valueOriginal=null;this.deps=[];this.depsBothWays=[];this.depsPholders={};this.transforms={};this.attachedEvents=[];this.customEventMethod={};if("function"===typeof a){this.setType("Func");c=this.setObject("function",a,b);if(c instanceof l)return c;d=1}else"number"===typeof this.selector&&(this.selector=this.selector.toString()),
p.ignoreCase&&(this.selector=this.property=this.selector.toLowerCase(),"textcontent"===this.selector&&(this.selector=this.property="textContent")),-1!==this.selector.indexOf(":")&&(c=this.property.split(":"),this.descriptor=c[0],this.property=c[1]),-1!==this.selector.indexOf(".")&&(c=this.property.split("."),this.property=c[0],this.placeholder=c.slice(1).join("."));return new l(this,d,this.placeholder)};l=function(a,b,c,d,e,g){var f;this.placeholder=c;this.stage=b||0;this.proxied=d;this.proxies=e&&
e.length?e:d?[d]:[];this.has=g?g:{tf:!1,massTf:!1,initBind:!1,interval:!1,event:!1};f=this;return Object.defineProperties(this,{ID:{get:function(){return a.ID}},value:{get:function(){return a.value}},original:{get:function(){return a.objects||a.object}},dependents:{get:function(){return a.deps.slice().map(function(a){return a.original})}},"new":{value:function(b,c,d){return new l(a,b,f.placeholder,c||f.proxied,d||f.proxies,f.has)}},_:{value:a}})};A.prototype={setObject:function(a,b,c,d,e){var g,f,
m,k,h;h=1;F(b)&&(b=b.original);if(w.jQuery&&b instanceof jQuery&&(f=!0,this.object=b=D(b),!b))return this.stage=0,u("emptyElList");if(b instanceof NodeList||b instanceof HTMLCollection||f&&Array.isArray(b)){if(0===b.length)return this.stage=0,u("emptyElList");this.object=null;k=this.objects=[].slice.call(b);b=0;for(f=k.length;b<f;b++)m=k[b],m.checked&&(this.object=m);this.object||(this.object=this.objects[0]);b=this.object}this.object=b;if("external"===a){this.type="Ajax";b={method:d};if(e)for(g in e)f=
e[g],b[g]=f;this.reqOptions=b;"POST"===d&&(h=3)}if(d=t[a].get(this))return this.placeholder&&!d.values&&(d.valueOriginal=d.fetchDirectValue(),d.scanForPholders()),new l(d,h,this.placeholder);this.isDom=this.object.nodeName&&1===this.object.nodeType;"Event"!==this.type&&(c=this.fetchDirectValue(null,c),this.isDom&&"value"!==this.property&&"textContent"!==this.property&&!this.descriptor&&(c=this.fetchDirectValue("DOMAttr")),"undefined"===typeof c&&"object"===a&&(this.object[this.property]=c=null),this.value=
this.valueOriginal=c,this.placeholder&&"object"===a&&!this.values&&this.scanForPholders());this.setID();this.setType();this.makePropertyLive();this.attachEvents();return t[a].set(this)},setEvent:function(a,b,c){isNaN(parseInt(this.property))&&u("badEventArg");this.type="Event";this.eventName=a;b&&(this.customEventMethod["in"]=b);if(c)return this.customEventMethod.out=c},processTransformCall:function(a,b){var c,d,e;if("function"!==typeof a)return u("transformFn");c=0;for(d=b.length;c<d;c++)e=b[c],
e=e._,this.addTransform(e.ID,a),-1!==this.depsBothWays.indexOf(e)&&e.addTransform(this.ID,a);this.updateDeps(this.ID,!0,!0);return!0},destroy:function(){var a,b,c,d,e;delete r[this.ID];if("Object"===this.type||"DOMProp"===this.type||"DOMText"===this.type)return Object.defineProperty(this.object,this.property,{value:this.value});if("Event"===this.type){d=this.attachedEvents;e=[];b=0;for(c=d.length;b<c;b++)a=d[b],e.push(this.unRegisterEvent(a,this.customEventMethod.remove));return e}},setID:function(){this.ID=
L();return r[this.ID]=this},setType:function(a){if(!this.type&&(this.type=a||"Object",this.isDom))return"value"===this.property?this.type="DOMValue":"textContent"===this.property?this.type="DOMText":"prop"===this.descriptor?this.type="DOMProp":this.type="DOMAttr"},scanForPholders:function(){this.values||(this.values={});this.regEx||(this.regEx=y);this.value=this.valueOriginal.replace(y,function(a){return function(b,c){return a.values[c]=c}}(this));if(this.isDom&&"textContent"===this.property)return this.scanTextNodesPlaceholders()},
attachEvents:function(){var a,b,c;if("Event"===this.type)return this.registerEvent(this.eventName,this.customEventMethod["in"]);if("DOMValue"===this.type||"DOMText"===this.type)if(a=this,b=function(b){if(!b.fromSimplyBind)return a.setValue(b.target.value)},c=this.objects?this.objects[0].nodeName.toUpperCase():this.object.nodeName.toUpperCase(),"INPUT"===c||"TEXTAREA"===c||"SELECT"===c){if("radio"===this.object.type||"checkbox"===this.object.type)return this.objects.forEach(function(a){return a.addEventListener("change",
b,!1)});this.object.addEventListener("input",b,!1);return this.object.addEventListener("change",b,!1)}},scanTextNodesPlaceholders:function(a){var b,c,d,e,g,f,m;null==a&&(a=this.object);f=a.childNodes;a=0;for(d=f.length;a<d;a++)e=f[a],3!==e.nodeType?this.scanTextNodesPlaceholders(e):t.textNodes.get(e)||(g=e.textContent,c=!1,m={},b=this,g.replace(this.regEx,function(a,d){c=!0;return m[d]=b.values[d]}),c||(m=null),t.textNodes.set(e,g,m))},getNodeFullValue:function(a,b,c){var d;return(a=t.textNodes.get(a))?
(d=a[1],a=a[0],d?(d[b]=c,a.replace(this.regEx,function(a,b){return d[b]})):a):!1},fetchDirectValue:function(a,b){null==a&&(a=this.type);switch(a){case "Func":if(!b)return this.object();break;case "Ajax":if(!b)return this.networkReq();break;case "DOMAttr":return this.object.getAttribute(this.property)||"";default:return this.object[this.property]}},applyTextContentReplace:function(a,b,c){var d,e,g,f,m;if(this.placeholder){f=a.childNodes;m=[];a=0;for(d=f.length;a<d;a++)g=f[a],3!==g.nodeType?m.push(this.applyTextContentReplace(g,
b,c)):(e=this.getNodeFullValue(g,b,c))?m.push(g.textContent=e):m.push(void 0);return m}return a.textContent=this.value},setValue:function(a,b,c,d,e){var g,f;g=b?this.values[b]:this.value;if(c!==this.ID&&(a!==g||p.updateEvenIfSame)){c||(c=this.ID);if("undefined"!==typeof a||p.updateEvenIfUndefined)b?(this.values[b]=f=a,this.value=a=this.applyPlaceholders()):this.value=a,this.arrayMethodsMutated?this.setArrayMethods():this.needsManualUpdate&&"Object"===this.type?this.object[this.property]=a:"Func"===
this.type?(b=this.valuePassed,this.valuePassed=a,this.value=this.object(a,b)):"Ajax"===this.type?(this.reqOptions.data=a,this.networkReq(c,d)):"Event"===this.type?e||(this.emitCauser=c,this.emitEvent(a),this.emitCauser=null):"DOMValue"===this.type?this.objects?this.objects.forEach(function(b){return b.value===a?b.checked=!0:b.checked=!1}):(this.object.value=this.value,p.dispatchEvents&&this.object.dispatchEvent(I())):"DOMProp"===this.type?this.inheritedOverriden||(this.object[this.property]=this.value):
"DOMAttr"===this.type?this.object.setAttribute(this.property,this.value):"DOMText"===this.type&&this.applyTextContentReplace(this.object,b,f);if("Ajax"!==this.type)return this.updateDeps(c,d)}},updateDeps:function(a,b,c){var d,e,g,f,m,k,h;if(this.deps.length&&("Event"!==this.type||null!==this.value))for(h=this.deps,m=0,k=h.length;m<k;m++)e=h[m],b&&-1!==this.depsBothWays.indexOf(e)||e.ID===this.emitCauser||(d=(g=e.depsPholders[this.ID])?this.values[g]:this.value,f=(g=this.depsPholders[e.ID])?e.values[g]:
e.value,d=this.applyTransform(e,d,f),c&&"Func"===e.type&&!p.invokeOnBind||e.setValue(d,g,a||this.ID,!0))},applyPlaceholders:function(){var a;a=this;return this.valueOriginal.replace(this.regEx,function(b,c){return a.values[c]})},applyTransform:function(a,b,c){return null!=this.transforms[a.ID]?this.transforms[a.ID](b,c):b},makePropertyLive:function(){var a,b,c,d,e,g,f;if(("Object"===this.type||"DOMProp"===this.type)&&p.liveProps)return b=this.object.propertyIsEnumerable(this.property),e=p.mutateInherited||
b,a=this,e?(e=Object.getOwnPropertyDescriptor(this.object,this.property),c=(null!=e?null!=(g=e.get)?g.bind(this.object):void 0:void 0)||function(){return a.value},d=(null!=e?null!=(f=e.set)?f.bind(this.object):void 0:void 0)||function(){},Object.defineProperty(this.object,this.property,{configurable:!0,enumerable:null!=e?e.enumerable:void 0,get:function(){return c()},set:function(b){a.setValue(b);return d(b)}}),b||(this.inheritedOverriden=!0)):this.needsManualUpdate=!0,this.setArrayMethods()},setArrayMethods:function(){var a;
if(p.mutateArrayMethods&&Array.isArray(this.value))return this.arrayMethodsMutated=!0,a=this,["push","pop","shift","unshift","splice"].forEach(function(b){return Object.defineProperty(a.value,b,{configurable:!0,value:function(){var c;c=Array.prototype[b].apply(a.value,arguments);a.updateDeps();return c}})})},invokeEventMethod:function(a,b,c){var d;d=this.object;if(this.isDom&&w.jQuery&&"on"===b||"off"===b)d=jQuery(this.object);d[b]||(b=c);this.eventHandler||(this.eventHandler=M.bind(this));return"function"===
typeof d[b]?d[b](a,this.eventHandler):void 0},emitEvent:function(a){var b,c;c=this.object;b=this.customEventMethod.out||"dispatchEvent";this.isDom&&w.jQuery&&"trigger"===b&&(c=jQuery(this.object));c[b]||(b="dispatchEvent");return"dispatchEvent"===b?(this.eventObject||(this.eventObject=document.createEvent("Event"),this.eventObject.initEvent(this.eventName,!0,!0)),a!==this.eventObject&&(this.eventObject.boundData=a),c[b](this.eventObject)):c[b](this.eventName,a)},networkReq:function(a,b){var c,d,e,
g,f,h,k,l;k=this.object+":"+this.selector+"#"+this.reqOptions.method;f=G[k];h=null!=f?f.date:void 0;d=function(c){return function(){return c.updateDeps(a,b)}}(this);if(h&&h!==this.lastReq&&p.cacheRequests)this.value=f.data,"*"!==this.property&&(this.value=this.value[this.property]),d();else try{this.lastReq=Date.now();this.reqOptions.data&&(c=JSON.stringify(this.reqOptions.data));this.xhr=new XMLHttpRequest;this.xhr.open(this.reqOptions.method.toUpperCase(),this.object,!0);g=this.reqOptions.headers;
for(e in g)l=g[e],this.xhr.setRequestHeader(e,l);this.xhr.onreadystatechange=function(a){return function(){var b;if(4===a.xhr.readyState){if(a.value=b=a.xhr.responseText)try{a.value=JSON.parse(b),"*"!==a.property&&(a.value=a.value[a.property])}catch(c){}G[k]={date:a.lastReq,data:a.value};return d()}}}(this);this.xhr.send(c)}catch(n){}},addDep:function(a,b,c){-1===this.deps.indexOf(a._)&&this.deps.push(a._);a.placeholder&&(this.depsPholders[a.ID]=a.placeholder);c?-1===this.depsBothWays.indexOf(a._)&&
this.depsBothWays.push(a._):-1!==a._.deps.indexOf(this)&&(a._.addDep(b,a,!0),this.addDep(a,b,!0));return this},removeDep:function(a,b){var c;c=this.deps.indexOf(a);-1!==c&&(this.deps.splice(c,1),delete this.depsPholders[a.ID]);if(b&&(a.removeDep(this),c=this.depsBothWays.indexOf(a),-1!==c))return this.depsBothWays.splice(c,1)},removeAllDeps:function(a){var b,c,d,e;e=this.deps.slice();c=0;for(d=e.length;c<d;c++)b=e[c],this.removeDep(b,a);if(a)return this.destroy()},addTransform:function(a,b){return this.transforms[a]=
b},registerEvent:function(a,b){if(-1===this.attachedEvents.indexOf(a))return this.attachedEvents.push(a),this.invokeEventMethod(a,b||"addEventListener","addEventListener")},unRegisterEvent:function(a,b){var c;c=this.attachedEvents.indexOf(a);if(-1!==c)return this.attachedEvents.splice(c,1),this.invokeEventMethod(a,b||"removeEventListener","removeEventListener")},addPollInterval:function(a){return this.pollInterval=setInterval(function(a){return function(){var c;c=a.fetchDirectValue();if(c!==a.value)return a.setValue(c)}}(this),
a)},removePollInterval:function(){clearInterval(this.pollInterval);return this.pollInterval=null}};M=function(){var a;a="Event"===this.type?arguments[this.property]:this.fetchDirectValue();return this.setValue(a,null,null,null,!0)};l.prototype={of:function(a){var b,c;0!==this.stage&&2!==this.stage&&h(k[0]);"object"!==typeof a&&"function"!==typeof a&&z("badObject");0===this.stage?c=this._.setObject("object",a):(b=this.proxies.indexOf(this.proxied),this.proxied=this.proxied.of(a),this.proxies[b]=this.proxied,
this.has.initBind=!0,this.has.tf=!1,this._.addDep(this.proxied,this),x(this));return c instanceof l?c:this["new"](this.stage+1)},ofEvent:function(a,b,c){(0!==this.stage||this.has.event)&&h(k[1]);if(!a||"string"!==typeof a)return this;this._.setEvent(a,b,c);this.has.event=!0;return this["new"](0)},ofExternal:function(a,b,c){(0!==this.stage||this.has.event)&&h(k[2]);if(b&&"object"!==typeof b||!a||"string"!==typeof a)return this;a=this._.setObject("external",a,c,c?"POST":"GET",b);return a instanceof
l?a:this["new"](1)},to:function(a){(1!==this.stage||this.has.initBind)&&h(k[3]);if(null==a)return this;this.proxied=B(this,a);0===this.proxied.stage?a=2:(a=3,this.has.initBind=!0);return this["new"](a)},and:function(a){3===this.stage&&this.has.initBind&&!this.has.massTf||h(k[4]);if(null==a)return this;this.proxied=B(this,a);this.proxies=this.proxies.concat(this.proxied);0===this.proxied.stage?a=2:(a=3,this.has.tf=!1);return this["new"](a)},toExternal:function(a,b){1!==this.stage&&h(k[5]);if(b&&"object"!==
typeof b||!a||"string"!==typeof a)return this;this.proxied=q("*").ofExternal(a,b,!0);this._.addDep(this.proxied,this);this.has.initBind=!0;x(this);return this["new"](3,this.proxied)},toEvent:function(a,b,c){1!==this.stage&&h(k[1]);if(!a||"string"!==typeof a)return this;this.proxied=q(0).ofEvent(a,c,b);this._.addDep(this.proxied,this);return this["new"](2)},set:function(a){0!==this.stage&&2!==this.stage||h(k[6]);this._.setValue(a,this.placeholder);return this},get:function(){0!==this.stage&&2!==this.stage||
h(k[7]);return this.placeholder?this._.values[this.placeholder]:this._.value},transform:function(a){(3!==this.stage||this.has.tf||this.has.massTf)&&h(k[8]);this.has.tf=this._.processTransformCall(a,[this.proxied])||!1;return this["new"](3)},transformAll:function(a){(3!==this.stage||this.has.tf||this.has.massTf)&&h(k[9]);this.has.massTf=this._.processTransformCall(a,this.proxies)||!1;return this["new"](3)},bothWays:function(a){var b,c;(3!==this.stage||this.has.massTf)&&h(k[10]);b=this.proxied._.addDep(this,
this.proxied,!0);((c=this._.transforms[this.proxied.ID])||a)&&(c="function"===typeof a?a:c)&&!1!==a&&b.addTransform(this.ID,c);this._.addDep(this.proxied,this,!0);return this},unBind:function(a){3!==this.stage&&h(k[11]);this._.removeDep(this.proxied._,a);return this},chainTo:function(a){3!==this.stage&&h(k[12]);return q(this.proxied).to(a)},pollEvery:function(a){(3!==this.stage||"Event"===this._.type||this.has.interval)&&h(k[13]);this._.addPollInterval(a);this.has.interval=!0;return this["new"](3)},
stopPolling:function(){3===this.stage&&this.has.interval||h(k[14]);this._.removePollInterval();return this["new"](3)},updateDepsOnEvent:function(a,b){3!==this.stage&&h(k[15]);this._.registerEvent(a,b);return this},removeEvent:function(a,b){3!==this.stage&&h(k[16]);this._.unRegisterEvent(a,b);return this}};l.prototype.update=l.prototype.set;l.prototype.twoWay=l.prototype.bothWays;l.prototype.pipe=l.prototype.chainTo;k=Object.keys(l.prototype);B=function(a,b){var c;a.proxied=c=q(b,!0);0!==c.stage&&
(a._.addDep(c,a),x(a));return c};x=function(a){if("Func"!==a.proxied._.type||p.invokeOnBind)return a._.updateDeps(a.ID,!0)};Object.defineProperty(q,"options",{get:function(){return p}});q.setOption=function(a,b){var c;if(-1!==Object.keys(p).indexOf(a)&&(-1!==a.indexOf("place")&&(c=!0,v[a.slice(11).toLowerCase()]=b.replace(/(.)/g,"\\$1")),p[a]=b,c))return H()};q.setOptions=function(a){var b;b=Object.keys(a);if(b.length)return b.forEach(function(b){return q.setOption(b,a[b])})};q.unBindAll=function(a,
b){var c,d,e;if(a&&("object"===typeof a||"function"===typeof a)&&(a=K(a),c=n.objects.indexOf(a),-1!==c))for(e in d=n.props[c],d)c=d[e],r[c].removeAllDeps(b)};return window.SimplyBind=q})();
