(function(){var t,e;isPageManagement&&(t={list:$(".manage-content"),template:$(fieldTemplates.page),items:[],addExisting:function(t){var i;return i=new e(t.attr("id"),t.data("slug"),t.find(".manage-content-list-title-text").html(),!t.hasClass("disabled"),t.data("rotation"),t),this.items.push(i),i},add:function(i,s){var n,a;return n=s?s.clone():this.template.clone(),a=new e("",i.slug,i.label,!0,!1,n,i),this.items.push(a),a.el.data("show",!0).data("new",!0).data("slug",a.slug).attr("id","").addClass(a.slug).find(".manage-content-list-item").data("closed",!0).end().appendTo(t.list),a.show(),initForm(a.el),a},remove:function(t){var e,i;return i=this.items.filter(function(e){return e.slug===t}),e=this.items.indexOf(i),-1!==e?(this.items.splice(e,1),!0):!1}},e=function(t,e,i,s,n,a,o){var r;return this.id=t,this.slug=e,this.name=i,this.enabled=!!s,this.rotation=n,this.el=a,this.elTitle=a.find(".manage-content-list-title-text").first(),this.variations=a.find(".manage-content-list-item"),this.sidebar=o||SIDEBAR.items.filter(function(t){return function(e){return e.slug===t.slug}}(this))[0],this.toggle=a.find(".rotation"),this.fieldName=a.find('.page_data[name="name"]'),this.fieldSlug=a.find('.page_data[name="slug"]'),this.fieldVar=a.find(".currentVariation"),this.currentVariation=this.fieldVar.val()||0,this.el.data("item",this),this.sidebar.assocItem=this,SimplyBind("name").of(this).to("value").of(this.fieldName).bothWays(),SimplyBind("value").of(this.fieldName).to("textContent").of(this.elTitle),SimplyBind("value").of(this.fieldName).to("label").of(this.sidebar),SimplyBind("value").of(this.fieldName).to(function(t){return function(e){return DB.page.update({id:t.id,name:"name",value:e})}}(this)),r=function(t){return t.toLowerCase().replace(/\s/g,"-")},SimplyBind("slug").of(this).to("slug").of(this.sidebar).bothWays().withTransform(r),SimplyBind("slug").of(this).to("value").of(this.fieldSlug).bothWays().withTransform(r),SimplyBind("value").of(this.fieldSlug).to("class.slug").of(this.el).withTransform(r),SimplyBind("value").of(this.fieldSlug).to(function(t){return function(e){return DB.page.update({id:t.id,name:"slug",value:r(e)})}}(this)),SimplyBind("value").of(this.fieldVar).to("currentVariation").of(this),SimplyBind("value").of(this.fieldVar).to(function(t){return function(e){return DB.page.update({id:t.id,name:"currentVariation",value:e-1})}}(this)),SimplyBind("rotation").of(this).to("class.state").of(this.toggle),this},e.prototype.show=function(){return this.el.addClass("show").siblings().removeClass("show")},e.prototype.hide=function(){return this.el.removeClass("show")},e.prototype.disable=function(){return this.enabled=!this.enabled,DB.page.update({id:this.el.attr("id"),name:"enabled",value:this.enabled,cb:function(t){return function(e){return e.success?t.el.toggleClass("disabled"):void 0}}(this)}),this.enabled?this.el.addClass("disabled"):this.el.removeClass("disabled"),log(this.enabled,this.el[0])},e.prototype.clone=function(){var e,i,s,n;return e=this.sidebar.label+" (Copy)",s=this.sidebar.slug+"-copy",i=SIDEBAR.add(e,s,this.sidebar.el),n=t.add(i,this.el),n.show(),n.save(!0)},e.prototype.fetchValues=function(){var t,e;return e=this.el.data("Form").fetchValues(),e.forEach(function(t){return function(i,s){return e[s].enabled=!t.variations.eq(s).hasClass("disabled")}}(this)),t=function(e){return e.constructor===Array&&e.forEach(function(e){return t(e)}),e.constructor===Object?Object.keys(e).forEach(function(i){if("image"===i){if(!e[i])return delete e[i]}else if(e[i].constructor===Object||e[i].constructor===Array)return t(e[i])}):void 0},t(e),e},e.prototype.save=function(t){var e,i;return e=t?"insert":"update",i={name:this.name,slug:this.slug,enabled:this.enabled,rotation:!!this.rotation,currentVariation:this.currentVariation-1,variations:this.fetchValues()},t?DB.page.insert({data:i,cb:function(t){return function(e){return e.success?(console.log("Page created/added successfuly."),$.post("/api/get/pages",{slug:t.slug},function(e){return t.id=e[0]._id,t.el.attr("id",e[0]._id)})):void 0}}(this)}):DB.page.update({id:this.id,data:i})},e.prototype.remove=function(){var e;return e=!this.sidebar.el.siblings().length,e?alert("You cannot delete the last page in the database."):confirm("Are you sure you want to delete this page?")&&(t.remove(this.slug),SIDEBAR.remove(this.slug),this.id)?DB.page.remove({id:this.id,cb:function(t){return function(e){return e.success?t.el.removeClass("show").prev().addClass("show").end().remove():void 0}}(this)}):void 0},$(".manage-content").find(".manage-content-list").each(function(){return t.addExisting($(this))}))}).call(this);
