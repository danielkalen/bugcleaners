(function(){var e;isPageManagement&&(e=function(e,t,i){return this.page=t,this["new"]=!!i,this.index=e.data("variation"),this.enabled=!e.hasClass("disabled"),this.el=e,this.elTitle=e.children("h6").children().eq(0),this.elNotes=e.children("h6").children().eq(1),this.fieldNotes=e.find(".varNotes").find("input"),this.statusField=e.find(".manage-content-list-item-content-status"),e.data("item",this),SimplyBind("index").of(this).to("textContent.index").of(this.elTitle),SimplyBind("value").of(this.fieldNotes).to("textContent.notes").of(this.elNotes).bothWays().withTransform(function(e){return e?"("+e+")":e}),this},e.prototype.fetchValues=function(){return this.page.fetchValues()[this.index]},e.prototype.clone=function(){return this.page.addVariation(this.el)},e.prototype.disable=function(){var e;return this.enabled=!this.enabled,e={},e["variations."+this.index+".enabled"]=this.enabled,DB.variation.update({id:this.page.id,data:e,cb:function(e){return function(t){return t.success?e.el.toggleClass("disabled"):void 0}}(this)})},e.prototype["delete"]=function(){return this.page.variations.length>1?confirm("Are you sure you want to delete this?")?(this.page.removeVariation(this),DB.variation.remove({id:this.page.id,index:this.index,cb:function(e){return console.log("Variation #"+this.index+" successfuly removed")}})):void 0:alert("You must have at least one variation per page.")},e.prototype.save=function(){var e,t,i,s;if(this.page.form.Validate()){if(this.el.addClass("sending").removeClass("save_success save_error"),e={},s=this.fetchValues(),this["new"])e.$push={variations:s};else{e.$set={};for(t in s)i=s[t],e.$set["variations."+this.index+"."+t]=i}return DB.variation.save({id:this.page.id,data:e,cb:function(e){return function(t){var i;return i=t.success?"save_success":"save_error",e.statusField.html(t.message),e.el.removeClass("sending").addClass(i),setTimeout(function(){return e.el.removeClass("save_success save_error"),e.statusField.html("")},3500),e["new"]?e["new"]=!1:void 0}}(this)})}return this.page.form.focusOnFirstErrorField(),this.statusField.html("Some fields have errors..."),setTimeout(function(e){return function(){return e.statusField.html("")}}(this),3500)})}).call(this);
